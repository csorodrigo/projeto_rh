# Widget de Alertas de Compliance - Exemplos e Casos de Uso

## Exemplos Visuais de Alertas

### 1. Funcion√°rios sem PIS

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë üî¥ Funcion√°rios sem PIS                            [3]   ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Cadastro de PIS √© obrigat√≥rio para gera√ß√£o de AFD e AEJ ‚ïë
‚ïë                                                          ‚ïë
‚ïë Jo√£o Silva, Maria Santos, Pedro Costa                   ‚ïë
‚ïë ‚Üí Corrigir problema                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

### 2. Registros Faltantes Hoje

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë üü° Registros faltantes hoje                        [5]   ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Funcion√°rios sem marca√ß√£o de entrada/sa√≠da              ‚ïë
‚ïë                                                          ‚ïë
‚ïë Ana Paula, Carlos Lima, Juliana Souza...                ‚ïë
‚ïë ‚Üí Corrigir problema                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

### 3. Viola√ß√µes de Jornada

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë üî¥ Viola√ß√µes de jornada                            [8]   ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë Funcion√°rios com mais de 10h trabalhadas/dia            ‚ïë
‚ïë                                                          ‚ïë
‚ïë Roberto Alves (3x), Fernanda Costa (2x)...              ‚ïë
‚ïë ‚Üí Corrigir problema                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

### 4. Estado Vazio (Tudo OK)

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    ‚úÖ                                    ‚ïë
‚ïë              Tudo em conformidade!                       ‚ïë
‚ïë       Nenhum problema detectado no momento              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

## Casos de Uso Pr√°ticos

### Caso 1: Novo Funcion√°rio sem PIS

**Cen√°rio**: RH cadastra funcion√°rio mas esquece de preencher PIS

**Fluxo**:
1. Dashboard exibe alerta vermelho "Funcion√°rios sem PIS"
2. Badge mostra [1]
3. Tooltip mostra nome do funcion√°rio
4. Gerente clica "Corrigir problema"
5. Navega para /funcionarios
6. Edita cadastro e adiciona PIS
7. Alerta desaparece no pr√≥ximo refresh

### Caso 2: Jornada Excessiva

**Cen√°rio**: Funcion√°rio trabalha 12h devido a demanda

**Fluxo**:
1. Sistema calcula horas trabalhadas no `time_tracking_daily`
2. Widget detecta `worked_minutes = 720` (12h > 10h)
3. Dashboard exibe alerta vermelho
4. Mostra "Roberto Alves (1x)"
5. Gerente clica para ver relat√≥rio completo
6. Verifica se h√° justificativa
7. Aprova banco de horas ou registra hora extra

### Caso 3: Interjornada Violada

**Cen√°rio**: Funcion√°rio sai 23h e entra 7h (8h de descanso)

**Fluxo**:
1. Widget compara `clock_out` com `clock_in` do dia seguinte
2. Calcula: 7h - 23h = 8 horas (< 11h)
3. Exibe alerta: "Interjornada n√£o respeitada"
4. Gerente revisa escala
5. Ajusta hor√°rio ou registra exce√ß√£o
6. Evita multa trabalhista

### Caso 4: Marca√ß√µes Duplicadas

**Cen√°rio**: Funcion√°rio bate ponto 2x por engano

**Fluxo**:
1. Sistema detecta dois `clock_in` √†s 8:00 e 8:02
2. Widget alerta marca√ß√µes duplicadas
3. Gerente acessa /ponto
4. Remove registro duplicado
5. Limpa inconsist√™ncia no banco

## Exemplos de Queries SQL

### Query 1: Buscar Funcion√°rios sem PIS

```sql
SELECT
  id,
  name,
  pis
FROM employees
WHERE
  company_id = '123e4567-e89b-12d3-a456-426614174000'
  AND status = 'active'
  AND (pis IS NULL OR pis = '');
```

### Query 2: Viola√ß√µes de Jornada (√öltimos 7 dias)

```sql
SELECT
  td.id,
  td.employee_id,
  td.date,
  td.worked_minutes,
  e.name
FROM time_tracking_daily td
INNER JOIN employees e ON e.id = td.employee_id
WHERE
  td.company_id = '123e4567-e89b-12d3-a456-426614174000'
  AND td.date >= CURRENT_DATE - INTERVAL '7 days'
  AND td.worked_minutes > 600
ORDER BY td.date DESC, e.name;
```

### Query 3: Registros Faltantes Hoje

```sql
-- Funcion√°rios ativos
SELECT id, name FROM employees
WHERE company_id = '...' AND status = 'active';

-- Menos ausentes
SELECT DISTINCT employee_id FROM absences
WHERE
  company_id = '...'
  AND status IN ('approved', 'in_progress')
  AND start_date <= CURRENT_DATE
  AND end_date >= CURRENT_DATE;

-- Menos com registros
SELECT DISTINCT employee_id FROM time_records
WHERE
  company_id = '...'
  AND recorded_at::date = CURRENT_DATE;
```

## Testes Automatizados (Sugest√£o)

### Teste 1: Verificar Alerta de PIS

```typescript
test('deve exibir alerta quando funcion√°rio n√£o tem PIS', async () => {
  // Criar funcion√°rio sem PIS
  await createEmployee({ name: 'Jo√£o Silva', pis: null })

  // Renderizar widget
  render(<ComplianceAlertsWidget companyId="..." />)

  // Aguardar carregamento
  await waitFor(() => {
    expect(screen.getByText('Funcion√°rios sem PIS')).toBeInTheDocument()
    expect(screen.getByText('1')).toBeInTheDocument()
  })
})
```

### Teste 2: Estado Vazio

```typescript
test('deve exibir "Tudo em conformidade" quando n√£o h√° alertas', async () => {
  // Sem viola√ß√µes
  render(<ComplianceAlertsWidget companyId="..." />)

  await waitFor(() => {
    expect(screen.getByText('Tudo em conformidade!')).toBeInTheDocument()
    expect(screen.getByText('CheckCircle2')).toBeInTheDocument()
  })
})
```

### Teste 3: Link de A√ß√£o

```typescript
test('deve navegar para /ponto ao clicar em corrigir', async () => {
  render(<ComplianceAlertsWidget companyId="..." />)

  const link = await screen.findByText('Corrigir problema')
  expect(link).toHaveAttribute('href', '/ponto')
})
```

## Integra√ß√µes Futuras

### 1. Notifica√ß√µes por Email

```typescript
// Enviar email di√°rio com resumo de alertas
async function sendDailyComplianceReport(companyId: string) {
  const alerts = await getComplianceAlerts(companyId)

  if (alerts.length === 0) return

  const html = generateEmailTemplate(alerts)

  await sendEmail({
    to: 'gerente@empresa.com',
    subject: `‚ö†Ô∏è ${alerts.length} alertas de compliance`,
    html
  })
}
```

### 2. Webhook para Slack

```typescript
// Notificar no Slack quando alerta cr√≠tico aparecer
async function notifySlackOnCriticalAlert(alert: ComplianceAlert) {
  if (alert.severity !== 'error') return

  await fetch('https://hooks.slack.com/services/...', {
    method: 'POST',
    body: JSON.stringify({
      text: `üö® Alerta Cr√≠tico: ${alert.title}`,
      blocks: [
        {
          type: 'section',
          text: {
            type: 'mrkdwn',
            text: `*${alert.title}*\n${alert.description}\n\nFuncion√°rios: ${alert.count}`
          }
        }
      ]
    })
  })
}
```

### 3. Dashboard Analytics

```typescript
// Rastrear m√©tricas de compliance ao longo do tempo
interface ComplianceMetrics {
  date: string
  totalAlerts: number
  criticalAlerts: number
  warningAlerts: number
  resolvedAlerts: number
}

async function trackComplianceMetrics(companyId: string) {
  const alerts = await getComplianceAlerts(companyId)

  const metrics: ComplianceMetrics = {
    date: new Date().toISOString(),
    totalAlerts: alerts.length,
    criticalAlerts: alerts.filter(a => a.severity === 'error').length,
    warningAlerts: alerts.filter(a => a.severity === 'warning').length,
    resolvedAlerts: 0 // Buscar do hist√≥rico
  }

  await saveMetrics(metrics)
}
```

## Performance e Otimiza√ß√µes

### Caching

```typescript
// Cache de 5 minutos para alertas
const CACHE_TTL = 5 * 60 * 1000

let alertsCache: {
  data: ComplianceAlert[]
  timestamp: number
} | null = null

export async function getComplianceAlertsWithCache(
  companyId: string
): Promise<ComplianceAlert[]> {
  const now = Date.now()

  if (alertsCache && now - alertsCache.timestamp < CACHE_TTL) {
    return alertsCache.data
  }

  const alerts = await getComplianceAlerts(companyId)

  alertsCache = {
    data: alerts,
    timestamp: now
  }

  return alerts
}
```

### Pagina√ß√£o para Grandes Volumes

```typescript
// Limitar alertas exibidos no widget
const MAX_ALERTS_DISPLAYED = 5

export function ComplianceAlertsWidget({ companyId }: Props) {
  const [alerts, setAlerts] = useState<ComplianceAlert[]>([])
  const [showAll, setShowAll] = useState(false)

  const displayedAlerts = showAll
    ? alerts
    : alerts.slice(0, MAX_ALERTS_DISPLAYED)

  return (
    <div>
      {displayedAlerts.map(alert => <AlertItem {...} />)}

      {alerts.length > MAX_ALERTS_DISPLAYED && !showAll && (
        <Button onClick={() => setShowAll(true)}>
          Ver mais {alerts.length - MAX_ALERTS_DISPLAYED} alertas
        </Button>
      )}
    </div>
  )
}
```

## Checklist de Deploy

Antes de colocar em produ√ß√£o:

- [ ] Testar com empresa sem funcion√°rios
- [ ] Testar com empresa com 1000+ funcion√°rios
- [ ] Verificar permiss√µes RLS no Supabase
- [ ] Testar todos os links de a√ß√£o
- [ ] Validar tooltips com nomes longos
- [ ] Testar em mobile (responsividade)
- [ ] Verificar performance das queries
- [ ] Adicionar √≠ndices no banco se necess√°rio
- [ ] Configurar monitoramento de erros
- [ ] Documentar para equipe de suporte

## Troubleshooting

### Alerta n√£o aparece mesmo com viola√ß√£o

1. Verificar se `company_id` est√° correto
2. Checar RLS policies no Supabase
3. Validar status do funcion√°rio (deve ser 'active')
4. Conferir timezone dos registros

### Performance lenta

1. Adicionar √≠ndices:
```sql
CREATE INDEX idx_time_tracking_daily_worked_minutes
ON time_tracking_daily(company_id, worked_minutes);

CREATE INDEX idx_employees_pis
ON employees(company_id, pis) WHERE status = 'active';
```

2. Limitar per√≠odo de busca (m√°ximo 30 dias)

3. Implementar cache conforme exemplo acima

### Alertas duplicados

Verificar unicidade em `checkDuplicateRecords`:
- Intervalo de 5 minutos est√° adequado?
- Considerar mesma localiza√ß√£o GPS?

## Recursos Adicionais

- [Documenta√ß√£o CLT - Jornada de Trabalho](https://www.planalto.gov.br/ccivil_03/decreto-lei/del5452.htm)
- [Portaria 671/2021 - Registro de Ponto](https://www.in.gov.br/en/web/dou/-/portaria-n-671-de-8-de-novembro-de-2021-358060881)
- [e-Social - Layout AFD](http://www.esocial.gov.br/)
- [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)

---

**√öltima atualiza√ß√£o**: 29/01/2026
**Vers√£o**: 1.0.0
**Status**: Produ√ß√£o Ready ‚úÖ
