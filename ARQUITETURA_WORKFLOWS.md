# Arquitetura do Sistema de Workflows

## VisÃ£o Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SISTEMA DE WORKFLOWS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â”€â”€â”€â”€â–¶â”‚   Backend    â”‚â”€â”€â”€â”€â–¶â”‚   Database   â”‚
â”‚  (React/TS)  â”‚     â”‚ (API/Engine) â”‚     â”‚  (Supabase)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Camadas da AplicaÃ§Ã£o

### 1. Frontend Layer

```
/aprovacoes (Page)
    â”‚
    â”œâ”€â”€ Cards de EstatÃ­sticas
    â”‚   â””â”€â”€ Pendentes, Atrasadas, Aprovadas, Rejeitadas
    â”‚
    â”œâ”€â”€ Filtros & Bulk Actions
    â”‚   â””â”€â”€ Tipo, Busca, Selecionar MÃºltiplos
    â”‚
    â”œâ”€â”€ Tabs (4)
    â”‚   â”œâ”€â”€ Pendentes
    â”‚   â”‚   â””â”€â”€ ApprovalCard []
    â”‚   â”œâ”€â”€ Aprovadas
    â”‚   â”‚   â””â”€â”€ ApprovalCard []
    â”‚   â”œâ”€â”€ Rejeitadas
    â”‚   â”‚   â””â”€â”€ ApprovalCard []
    â”‚   â””â”€â”€ Com Atraso
    â”‚       â””â”€â”€ ApprovalCard []
    â”‚
    â””â”€â”€ Modais
        â”œâ”€â”€ DelegationModal
        â””â”€â”€ RejectModal
```

### 2. Components Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApprovalCard                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Avatar | Nome | Departamento     | SLA Badgeâ”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ğŸ“… Datas                                     â”‚   â”‚
â”‚  â”‚ ğŸ“„ Motivo                                    â”‚   â”‚
â”‚  â”‚ â° Tempo desde solicitaÃ§Ã£o                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [âœ“ Aprovar] [âœ— Rejeitar] [ğŸ‘ Detalhes]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApprovalTimeline                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ“ Solicitado      JoÃ£o Silva    15/02 10:30 â”‚   â”‚
â”‚  â”‚ â”‚                                             â”‚   â”‚
â”‚  â”‚ âœ“ Aprovado Gestor Maria Santos  15/02 14:00 â”‚   â”‚
â”‚  â”‚ â”‚                 "Aprovado!"                 â”‚   â”‚
â”‚  â”‚ â³ Aguardando RH   Pedro Costa   Pendente    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DelegationModal                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Delegar para: [Select User â–¼]               â”‚   â”‚
â”‚  â”‚ Data inÃ­cio:  [2026-02-01]                   â”‚   â”‚
â”‚  â”‚ Data fim:     [2026-02-07]                   â”‚   â”‚
â”‚  â”‚ Motivo:       [FÃ©rias...]                    â”‚   â”‚
â”‚  â”‚                                               â”‚   â”‚
â”‚  â”‚ â„¹ï¸ Todas aprovaÃ§Ãµes serÃ£o direcionadas       â”‚   â”‚
â”‚  â”‚   para Maria Santos                          â”‚   â”‚
â”‚  â”‚                                               â”‚   â”‚
â”‚  â”‚           [Cancelar] [Confirmar]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Engine Layer

```
WorkflowEngine
    â”‚
    â”œâ”€â”€ createWorkflowInstance()
    â”‚   â”œâ”€â”€ Buscar definiÃ§Ã£o
    â”‚   â”œâ”€â”€ Verificar auto-aprovaÃ§Ã£o
    â”‚   â”œâ”€â”€ Criar instÃ¢ncia
    â”‚   â”œâ”€â”€ Criar aprovaÃ§Ãµes step 1
    â”‚   â””â”€â”€ Adicionar ao histÃ³rico
    â”‚
    â”œâ”€â”€ approveStep()
    â”‚   â”œâ”€â”€ Atualizar aprovaÃ§Ã£o
    â”‚   â”œâ”€â”€ Verificar step completo
    â”‚   â”œâ”€â”€ Se completo:
    â”‚   â”‚   â”œâ”€â”€ Ãšltimo step? â†’ Completar workflow
    â”‚   â”‚   â””â”€â”€ NÃ£o? â†’ AvanÃ§ar para prÃ³ximo step
    â”‚   â””â”€â”€ Adicionar ao histÃ³rico
    â”‚
    â”œâ”€â”€ rejectStep()
    â”‚   â”œâ”€â”€ Atualizar aprovaÃ§Ã£o
    â”‚   â”œâ”€â”€ Marcar workflow como rejeitado
    â”‚   â””â”€â”€ Adicionar ao histÃ³rico
    â”‚
    â”œâ”€â”€ delegateApproval()
    â”‚   â””â”€â”€ Criar delegaÃ§Ã£o temporÃ¡ria
    â”‚
    â”œâ”€â”€ checkSLA()
    â”‚   â”œâ”€â”€ Buscar workflows atrasados
    â”‚   â”œâ”€â”€ Calcular horas de atraso
    â”‚   â””â”€â”€ Retornar lista
    â”‚
    â””â”€â”€ escalate()
        â”œâ”€â”€ Notificar superior
        â””â”€â”€ Registrar escalonamento
```

### 4. Database Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_definitions                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id, type, name, steps[], rules{}            â”‚ â”‚
â”‚  â”‚ - absence                                    â”‚ â”‚
â”‚  â”‚ - overtime                                   â”‚ â”‚
â”‚  â”‚ - time_adjustment                            â”‚ â”‚
â”‚  â”‚ - document_approval                          â”‚ â”‚
â”‚  â”‚ - data_change                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_instances                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id, workflow_type, entity_type, entity_id   â”‚ â”‚
â”‚  â”‚ current_step, total_steps, status           â”‚ â”‚
â”‚  â”‚ sla_due_at, metadata                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_approvals                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id, instance_id, step_level, approver_id   â”‚ â”‚
â”‚  â”‚ decision, comments, decided_at              â”‚ â”‚
â”‚  â”‚ sla_due_at, delegated_from                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_delegations                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id, from_user_id, to_user_id                â”‚ â”‚
â”‚  â”‚ start_date, end_date, active, reason        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  workflow_history                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id, instance_id, action, performed_by       â”‚ â”‚
â”‚  â”‚ old_status, new_status, step_level          â”‚ â”‚
â”‚  â”‚ comments, metadata, created_at              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Fluxo de Dados

### 1. CriaÃ§Ã£o de Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚SolicitaÃ§Ã£oâ”‚â”€â”€â”€â–¶â”‚Entidade  â”‚â”€â”€â”€â–¶â”‚Workflow  â”‚â”€â”€â”€â–¶â”‚AprovaÃ§Ã£o â”‚
â”‚(AusÃªncia) â”‚    â”‚(Absence) â”‚    â”‚Instance  â”‚    â”‚Step 1    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚Notificar â”‚
                                                 â”‚Aprovador â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. AprovaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Aprovador â”‚â”€â”€â”€â–¶â”‚Atualizar â”‚â”€â”€â”€â–¶â”‚Verificar â”‚â”€â”€â”€â–¶â”‚AvanÃ§ar   â”‚
â”‚Decide    â”‚    â”‚DecisÃ£o   â”‚    â”‚Completo? â”‚    â”‚Step      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚Notificar â”‚
                                                 â”‚PrÃ³ximo   â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. DelegaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚UsuÃ¡rio A â”‚â”€â”€â”€â–¶â”‚Criar     â”‚â”€â”€â”€â–¶â”‚AprovaÃ§Ãµesâ”‚
â”‚Delega    â”‚    â”‚DelegaÃ§Ã£o â”‚    â”‚â†’ UsuÃ¡rio Bâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚PerÃ­odo   â”‚
              â”‚Ativo     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. VerificaÃ§Ã£o SLA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Cron Job  â”‚â”€â”€â”€â–¶â”‚Buscar    â”‚â”€â”€â”€â–¶â”‚Notificar â”‚â”€â”€â”€â–¶â”‚Escalonar â”‚
â”‚(Hourly)  â”‚    â”‚Atrasados â”‚    â”‚Aprovador â”‚    â”‚Se >24h   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Estados do Workflow

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  DRAFT   â”‚ (futuro)
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚ submit
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PENDING  â”‚â—€â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
             â”‚             â”‚ next step
             â”‚ approve     â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚        â”‚
    â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚APPROVEDâ”‚ â”‚REJ â”‚ â”‚CANCELLEDâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## SLA Visual

```
CriaÃ§Ã£o          SLA Due          Agora
   â”‚               â”‚                â”‚
   â”‚â—€â”€â”€â”€â”€â”€24hâ”€â”€â”€â”€â”€â–¶â”‚                â”‚
   â”‚               â”‚                â”‚
   â–¼               â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ğŸŸ¢ OK â”‚       â”‚ğŸŸ  4h â”‚        â”‚ğŸ”´ SLAâ”‚
â”‚      â”‚       â”‚Rest. â”‚        â”‚Overdueâ”‚
â””â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜

Badges:
  ğŸŸ¢ Verde:   > 4h restantes
  ğŸŸ  Laranja: < 4h restantes
  ğŸ”´ Vermelho: SLA vencido
```

## Hierarquia de AprovaÃ§Ãµes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SOLICITANTE                   â”‚
â”‚           (Employee)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STEP 1                        â”‚
â”‚           Manager                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Manager A â”‚ â”‚Manager B â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                         â”‚
â”‚  requireAll: false â†’ Apenas 1           â”‚
â”‚  requireAll: true  â†’ Ambos              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STEP 2                        â”‚
â”‚           HR Manager                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚HR Managerâ”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚APPROVED â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Regras de NegÃ³cio

### Auto-aprovaÃ§Ã£o

```
IF (metadata.field OPERATOR value)
THEN status = 'approved'

Exemplo:
  IF (hours < 2)
  THEN status = 'approved'
```

### Skip Steps

```
IF (metadata.field OPERATOR value)
THEN skip_to_step = last_step

Exemplo:
  IF (days < 2)
  THEN skip_to_step = 1 (pular RH)
```

### RequireAll

```
IF (requireAll = true)
THEN wait_for_all_approvers()
ELSE wait_for_any_approver()
```

## SeguranÃ§a (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PolÃ­tica: Acesso por Empresa          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

workflow_instances:
  SELECT: company_id = user.company_id
  INSERT: company_id = user.company_id
          AND requester_id = user.id

workflow_approvals:
  SELECT: instance.company_id = user.company_id
  UPDATE: approver_id = user.id
          OR delegated_to = user.id

workflow_delegations:
  SELECT: from_user_id = user.id
          OR to_user_id = user.id
  INSERT: from_user_id = user.id
```

## Performance

### Ãndices

```
workflow_instances:
  - company_id
  - status + current_step
  - sla_due_at (WHERE status = 'pending')
  - entity_type + entity_id

workflow_approvals:
  - instance_id
  - approver_id + decision
  - approver_id (WHERE decision IS NULL)

workflow_delegations:
  - from_user_id + active
  - to_user_id + active
  - start_date + end_date (WHERE active = TRUE)
```

### Queries Otimizadas

```sql
-- AprovaÃ§Ãµes pendentes (usa Ã­ndice)
SELECT * FROM workflow_approvals
WHERE approver_id = $1
  AND decision IS NULL
ORDER BY created_at DESC;

-- Workflows atrasados (usa Ã­ndice parcial)
SELECT * FROM workflow_instances
WHERE company_id = $1
  AND status = 'pending'
  AND sla_due_at < NOW()
ORDER BY sla_due_at ASC;
```

## Monitoramento

### MÃ©tricas Importantes

1. **Taxa de AprovaÃ§Ã£o**
   - Aprovadas / Total
   - Por tipo de workflow
   - Por aprovador

2. **Tempo MÃ©dio**
   - Por step
   - Por tipo de workflow
   - Por aprovador

3. **SLA Compliance**
   - % dentro do prazo
   - % atrasadas
   - MÃ©dia de atraso

4. **Volume**
   - Workflows criados/dia
   - AprovaÃ§Ãµes pendentes
   - Workflows concluÃ­dos/dia

## Extensibilidade

### Adicionar Novo Tipo

```
1. Atualizar enum WorkflowType
   â””â”€â”€ src/types/database.ts

2. Criar definiÃ§Ã£o no banco
   â””â”€â”€ INSERT INTO workflow_definitions

3. Implementar lÃ³gica especÃ­fica
   â””â”€â”€ src/lib/workflows/engine.ts
       (se necessÃ¡rio)

4. Adicionar label e emoji
   â””â”€â”€ src/lib/workflows/utils.ts
```

### Customizar Regras

```
1. Modificar definiÃ§Ã£o
   â””â”€â”€ UPDATE workflow_definitions
       SET rules = {...}

2. Implementar lÃ³gica
   â””â”€â”€ WorkflowEngine.shouldAutoApprove()
       WorkflowEngine.shouldSkipStep()
```

### Adicionar NotificaÃ§Ãµes

```
1. Ao criar workflow
   â””â”€â”€ createWorkflowInstance()
       â†’ createNotification()

2. Ao aprovar
   â””â”€â”€ approveStep()
       â†’ notifyNextApprovers()

3. Ao rejeitar
   â””â”€â”€ rejectStep()
       â†’ notifyRequester()

4. SLA vencido
   â””â”€â”€ checkSLA()
       â†’ notifyOverdue()
```

## ConclusÃ£o

Sistema robusto, escalÃ¡vel e extensÃ­vel para gerenciamento de aprovaÃ§Ãµes multi-nÃ­vel com SLA, delegaÃ§Ã£o e auditoria completa.
